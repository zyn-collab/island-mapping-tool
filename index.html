<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map What's Here</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Main container for the entire app -->
    <div class="container-fluid">
        <!-- Start Screen -->
        <div id="start-screen" class="screen active">
            <div class="screen-header">
                <h1 class="app-title">Map what's here</h1>
                <p class="app-subtitle">Help build your island's map</p>
            </div>
            <div class="text-center">
                <button id="start-btn" class="btn btn-primary btn-lg">Start a new entry</button>
            </div>
        </div>

        <!-- Location Screen -->
        <div id="location-screen" class="screen">
            <div class="screen-header">
                <button id="back-to-start" class="btn btn-outline-secondary btn-sm">‚Üê Back</button>
                <h2>Confirm your location</h2>
                <p class="text-muted">We use your GPS to place a pin. Move the pin if needed.</p>
            </div>
            
            <!-- GPS Status and Coordinates Display -->
            <div id="gps-status" class="gps-info">
                <div class="row">
                    <div class="col-6">
                        <small class="text-muted">Latitude:</small>
                        <div id="lat-display">--</div>
                    </div>
                    <div class="col-6">
                        <small class="text-muted">Longitude:</small>
                        <div id="lon-display">--</div>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-12">
                        <small class="text-muted">GPS Accuracy:</small>
                        <div id="accuracy-display">--</div>
                    </div>
                </div>
            </div>

            <!-- Map Container -->
            <div id="map" class="map-container"></div>

            <!-- Location Controls -->
            <div class="location-controls">
                <button id="recenter-btn" class="btn btn-outline-primary">Recenter on me</button>
                <button id="manual-search-btn" class="btn btn-outline-secondary">Search place</button>
            </div>

            <!-- Manual Search Input (hidden by default) -->
            <div id="manual-search" class="manual-search" style="display: none;">
                <input type="text" id="search-input" class="form-control" placeholder="Search for a place or enter lat,lon">
                <button id="search-btn" class="btn btn-primary">Search</button>
            </div>

            <!-- Confirm Location Button -->
            <div class="confirm-section">
                <button id="confirm-location-btn" class="btn btn-success btn-lg">Looks right</button>
            </div>
        </div>

        <!-- Category Selection Popup -->
        <div id="category-popup" class="category-popup" style="display: none;">
            <div class="popup-content">
                <div class="popup-header">
                    <h3>What are you mapping?</h3>
                    <button id="close-popup" class="close-btn">&times;</button>
                </div>
                <div class="popup-search">
                    <input type="text" id="category-search-input" class="form-control" placeholder="Search for what you're mapping...">
                    <div id="search-results-container"></div>
                </div>
                <div id="category-grid-container">
                    <div id="quick-drop-grid" class="category-grid"></div>
                    <hr class="category-divider">
                    <div id="category-grid" class="category-grid"></div>
                </div>
            </div>
        </div>

        <!-- Form Screen -->
        <div id="form-screen" class="screen">
            <div class="screen-header">
                <button id="back-to-location" class="btn btn-outline-secondary btn-sm">‚Üê Back</button>
                <h2 id="selected-category-title">Select Category</h2>
                <p class="text-muted">Tap the category icon above to get started</p>
            </div>

            <!-- Selected Category Display -->
            <div id="selected-category" class="selected-category" style="display: none;">
                <div class="category-display">
                    <span id="category-icon" class="category-icon">üìç</span>
                    <div class="category-info">
                        <div id="category-name" class="category-name"></div>
                        <div id="category-description" class="category-description"></div>
                    </div>
                </div>
            </div>

            <!-- Subcategory Selection -->
            <div id="subcategory-section" class="form-section" style="display: none;">
                <label for="subcategory-select" class="form-label">What specifically?</label>
                <select id="subcategory-select" class="form-select" required>
                    <option value="">Select...</option>
                </select>
            </div>

            <!-- Dynamic Fields Container -->
            <div id="dynamic-fields"></div>

            <!-- Notes -->
            <div id="notes-section" class="form-section" style="display: none;">
                <label for="notes-input" class="form-label">Notes (optional)</label>
                <textarea id="notes-input" class="form-control" rows="3" placeholder="Add any additional details..." maxlength="500"></textarea>
                <div class="text-muted small">Characters: <span id="notes-count">0</span>/500</div>
            </div>

            <!-- Tags Selection -->
            <div id="tags-section" class="form-section" style="display: none;">
                <label class="form-label">Tags (optional)</label>
                <div id="tags-container" class="tags-container"></div>
            </div>

            <!-- Photos -->
            <div id="photos-section" class="form-section" style="display: none;">
                <label class="form-label">Photos (optional)</label>
                <div id="photo-container" class="photo-container">
                    <input type="file" id="photo-input" accept="image/*" multiple style="display: none;">
                    <button id="add-photo-btn" class="btn btn-outline-primary">üì∑ Add Photo</button>
                </div>
                <div id="photo-preview" class="photo-preview"></div>
            </div>

            <!-- Submit Button -->
            <div id="submit-section" class="submit-section" style="display: none;">
                <button id="submit-btn" class="btn btn-success btn-lg">Submit Entry</button>
            </div>
        </div>

        <!-- Success Screen -->
        <div id="success-screen" class="screen">
            <div class="text-center">
                <h2>Thanks!</h2>
                <p>Your entry was sent successfully.</p>
                <button id="new-entry-btn" class="btn btn-primary">Make another entry</button>
                <div class="mt-3">
                    <a href="#" id="privacy-link" class="text-muted small">Privacy & Consent Info</a>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div class="loading-text">Submitting...</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
